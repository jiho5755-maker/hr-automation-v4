# Product Requirements Document: 인사팀 자동화 시스템 통합

> **Traceability Note:** This PRD uses section numbers (§1-§10) that are referenced by the Technical Blueprint and Task List. All user answers have been mapped to specific sections.

## §1. Overview & Vision

인사팀 자동화 시스템의 6개 독립 모듈을 단일 포트(8000)에서 실행되는 하나의 통합 대시보드로 완전히 통합합니다. 현재 각각 다른 포트(8501-8505)에서 독립 실행되는 Streamlit 앱들을 Multipage App 패턴으로 재구성하고, 중앙 데이터베이스(hr_master.db)를 통한 실시간 데이터 동기화를 구현합니다. 직원 및 회사 정보를 통합 관리 페이지에서 한 번만 입력하면 모든 모듈에 자동으로 반영되어 데이터 중복 입력을 완전히 제거합니다.

**통합 범위:**
- **1단계 (우선)**: 출산육아 자동화 + 재택근무 관리 + 급여관리 자동화
- **2단계 (차후)**: 연말정산 자동화 + 정부지원금 자동화

**Key Outcomes:**
- 6개 포트를 1개 포트(8000)로 통합하여 시스템 복잡도 감소
- 통합 직원 관리 페이지를 통한 데이터 중복 입력 완전 제거
- 사이드바 네비게이션으로 모든 모듈 간 원활한 이동
- 급여관리 모듈의 계산 로직 → 명세서 자동 반영 완전 자동화
- 실제 데이터 기반 단계별 검증을 통한 안정적 통합

## §2. Problem Statement

현재 인사팀 자동화 시스템은 다음과 같은 심각한 문제를 겪고 있습니다:

**Current Pain Points:**
- **포트 분리로 인한 불편함**: 6개 모듈이 각각 다른 포트(8000, 8501-8505)에서 실행되어 사용자가 여러 브라우저 탭을 오가며 작업해야 함
- **데이터 입력 중복**: 직원 정보를 각 모듈마다 따로 입력해야 하며, 정보 변경 시 모든 모듈에서 수동으로 업데이트 필요
- **데이터 불일치**: 일부 모듈(출산육아)은 JSON 파일, 일부는 통합 DB를 사용하여 데이터 동기화 불가
- **급여관리 치명적 오류**: 4대보험, 소득세, 수당 등을 계산해도 급여명세서에 자동으로 반영되지 않아 수동 재입력 필요
- **통합 대시보드 미활용**: 통합 대시보드(8000)는 각 모듈로의 링크만 제공할 뿐 실제 통합 기능 없음
- **일관성 없는 데이터 흐름**: 각 모듈이 독립적으로 session_state 관리하여 모듈 간 데이터 공유 불가

## §3. Target Users

| User Type | Needs | Key Actions |
|-----------|-------|-------------|
| 인사 담당자 (Primary) | 직원 정보를 한 곳에서 관리하고 모든 인사 업무를 통합 환경에서 처리 | 직원 추가/수정, 출산육아 지원금 계산, 재택근무 기록 관리, 급여 계산 및 명세서 생성 |
| 급여 담당자 | 정확한 급여 계산과 자동화된 명세서 생성, 4대보험/세금 자동 계산 | 급여 설정, 월별 급여 계산, 급여대장 다운로드, 명세서 출력 |
| 관리자 (CEO/임원) | 전체 인사 현황을 한눈에 파악하고 의사결정에 필요한 데이터 조회 | 대시보드 조회, 직원 현황 파악, 지원금 현황 확인 |
| 일반 직원 | 본인의 근무 기록, 급여 정보, 연차 현황 조회 | 재택근무 기록 조회, 급여명세서 확인, 연차 사용 내역 조회 |

## §4. Core Requirements

### §4.1 Functional Requirements

| ID | Requirement | Priority | Source |
|----|-------------|----------|--------|
| FR-1 | 6개 독립 Streamlit 앱을 단일 포트 8000의 Multipage App으로 통합 | High | Q1, 원본 요구사항 |
| FR-2 | 사이드바 네비게이션으로 모든 모듈 간 원활한 이동 제공 | High | Q3 |
| FR-3 | 통합 직원 관리 페이지에서 직원 정보 CRUD 기능 제공 (이름, 부서, 직급, 입사일, 급여 정보 등) | High | Q2 |
| FR-4 | 직원 정보 입력/수정 시 모든 모듈에 실시간 자동 반영 | High | Q2, 원본 요구사항 |
| FR-5 | 출산육아 자동화 모듈을 통합 대시보드의 페이지로 변환 (재택근무 로그, 지원금 계산, 정부 서식 생성) | High | Q1 |
| FR-6 | 재택근무 관리 모듈을 통합 대시보드의 페이지로 변환 (일정 관리, 근무 기록, 월간 리포트) | High | Q1 |
| FR-7 | 급여관리 모듈을 통합 대시보드의 페이지로 변환 및 전면 개선 | High | Q1, Q4 |
| FR-8 | 급여관리: 4대보험 계산 결과가 급여명세서에 자동 반영 | Critical | Q4 |
| FR-9 | 급여관리: 소득세/지방소득세 계산 결과가 급여명세서에 자동 반영 | Critical | Q4 |
| FR-10 | 급여관리: 시간외 수당 계산 결과가 급여명세서에 자동 반영 | Critical | Q4 |
| FR-11 | 급여관리: 연차수당 계산 결과가 급여명세서에 자동 반영 | Critical | Q4 |
| FR-12 | 급여관리: 계산 → 명세서 데이터 흐름 완전 자동화 (수동 입력 제거) | Critical | Q4 |
| FR-13 | 모든 모듈이 hr_master.db 통합 데이터베이스 사용 (JSON 파일 의존성 제거) | High | 원본 요구사항, 코드베이스 분석 |
| FR-14 | 기존 JSON 기반 데이터(employees_data.json)를 hr_master.db로 마이그레이션 | High | 코드베이스 분석 |
| FR-15 | 사용자 로그인 후 모든 페이지에서 일관된 인증 상태 유지 | Medium | 코드베이스 분석 |
| FR-16 | 통합 대시보드 홈에서 전체 인사 현황 메트릭 표시 (직원 수, 특별 관리 직원, 예상 지원금 등) | Medium | 코드베이스 분석 |
| FR-17 | 연말정산 및 정부지원금 모듈은 1단계에서 제외 (2단계 작업) | Low | Q1 |

### §4.2 Non-Functional Requirements

| ID | Category | Requirement | Source |
|----|----------|-------------|--------|
| NFR-1 | Performance | 페이지 전환 시 1초 이내 응답 (session_state 기반 즉각 전환) | 기술 제약 |
| NFR-2 | Performance | 데이터베이스 쿼리 최적화 (인덱스 활용, N+1 쿼리 방지) | 기술 제약 |
| NFR-3 | Reliability | 급여 계산 정확도 100% (실제 데이터 기반 검증) | Q5 |
| NFR-4 | Reliability | 데이터 동기화 실시간성 보장 (직원 정보 변경 시 즉시 반영) | 원본 요구사항 |
| NFR-5 | Usability | 사이드바 네비게이션으로 3클릭 이내 모든 기능 접근 | Q3 |
| NFR-6 | Maintainability | 모듈별 코드 분리 유지 (pages/ 폴더 구조) | 기술 제약 |
| NFR-7 | Security | 사용자 인증 후에만 시스템 접근 가능 (shared/auth.py 활용) | 코드베이스 분석 |
| NFR-8 | Compatibility | 기존 데이터 완전 보존 (마이그레이션 후 데이터 무손실) | Q5 |
| NFR-9 | Testability | 단계별 통합 및 실제 데이터 기반 검증 가능 | Q5 |

## §5. User Stories & Acceptance Criteria

### Epic 1: 통합 대시보드 구축

#### Story §5.1: 사이드바 네비게이션 구축
**As a** 인사 담당자  
**I want** 사이드바에서 모든 모듈을 선택할 수 있다  
**So that** 여러 브라우저 탭 없이 하나의 화면에서 모든 업무를 처리할 수 있다

**Acceptance Criteria:**
- [ ] §5.1.1: 사이드바에 "📊 대시보드", "👥 직원 관리", "👶 출산육아", "🏠 재택근무", "💰 급여관리", "⚙️ 설정", "🚪 로그아웃" 메뉴 표시
- [ ] §5.1.2: 메뉴 선택 시 1초 이내 해당 페이지로 전환
- [ ] §5.1.3: 현재 선택된 메뉴 시각적으로 강조 표시
- [ ] §5.1.4: 로그인하지 않은 경우 로그인 페이지로 리다이렉트

#### Story §5.2: 통합 직원 관리 페이지
**As a** 인사 담당자  
**I want** 직원 정보를 한 곳에서 추가/수정/삭제할 수 있다  
**So that** 모든 모듈에서 동일한 직원 정보를 사용할 수 있다

**Acceptance Criteria:**
- [ ] §5.2.1: 직원 목록 테이블 표시 (이름, 부서, 직급, 입사일, 상태)
- [ ] §5.2.2: "➕ 새 직원 추가" 버튼 클릭 시 입력 폼 표시
- [ ] §5.2.3: 필수 정보 입력 (이름, 부서, 직급, 입사일)
- [ ] §5.2.4: 선택 정보 입력 (주민등록번호, 성별, 나이, 이메일, 전화번호, 급여 정보, 특수 상태)
- [ ] §5.2.5: 저장 시 hr_master.db에 즉시 저장되고 "✅ 저장 완료" 토스트 표시
- [ ] §5.2.6: 직원 정보 수정 시 모든 모듈에서 즉시 변경사항 반영 확인
- [ ] §5.2.7: 직원 삭제 시 확인 다이얼로그 표시 후 소프트 삭제 (is_active = 0)

#### Story §5.3: 통합 대시보드 홈 화면
**As a** 관리자  
**I want** 전체 인사 현황을 한눈에 볼 수 있다  
**So that** 빠른 의사결정을 할 수 있다

**Acceptance Criteria:**
- [ ] §5.3.1: 상단 메트릭 카드 표시 (등록 직원 수, 특별 관리 직원, 이번 달 근무 로그, 예상 지원금)
- [ ] §5.3.2: 회사 정보 섹션 표시 (회사명, 대표자, 사업자번호, 업종, 직원 수, 연매출)
- [ ] §5.3.3: 알림 섹션 표시 (임신 중인 직원, 휴직 중인 직원)
- [ ] §5.3.4: 최근 활동 로그 표시 (최근 10건)
- [ ] §5.3.5: 각 모듈 바로가기 버튼 제공

### Epic 2: 출산육아 모듈 통합

#### Story §5.4: 출산육아 모듈 페이지 전환
**As a** 인사 담당자  
**I want** 통합 대시보드 내에서 출산육아 기능을 사용할 수 있다  
**So that** 별도 포트로 이동하지 않고 바로 업무를 처리할 수 있다

**Acceptance Criteria:**
- [ ] §5.4.1: 사이드바에서 "👶 출산육아" 선택 시 출산육아 페이지로 전환
- [ ] §5.4.2: 직원 선택 드롭다운에 hr_master.db의 모든 직원 표시
- [ ] §5.4.3: 선택한 직원의 모든 정보 자동 로드 (통합 직원 관리에서 입력한 정보)
- [ ] §5.4.4: 재택근무 로그 생성, 지원금 계산, 정부 서식 PDF 생성 기능 정상 작동
- [ ] §5.4.5: JSON 파일(employees_data.json) 의존성 완전 제거

#### Story §5.5: 출산육아 데이터 마이그레이션
**As a** 시스템 관리자  
**I want** 기존 JSON 파일의 직원 데이터를 통합 DB로 이동할 수 있다  
**So that** 데이터 손실 없이 통합을 완료할 수 있다

**Acceptance Criteria:**
- [ ] §5.5.1: employees_data.json의 모든 직원 데이터를 hr_master.db로 마이그레이션
- [ ] §5.5.2: 마이그레이션 전후 데이터 건수 일치 확인
- [ ] §5.5.3: 마이그레이션 후 출산육아 모듈에서 모든 직원 정보 정상 조회
- [ ] §5.5.4: 마이그레이션 스크립트 실행 로그 기록

### Epic 3: 재택근무 모듈 통합

#### Story §5.6: 재택근무 모듈 페이지 전환
**As a** 인사 담당자  
**I want** 통합 대시보드 내에서 재택근무 관리 기능을 사용할 수 있다  
**So that** 재택근무 일정과 기록을 효율적으로 관리할 수 있다

**Acceptance Criteria:**
- [ ] §5.6.1: 사이드바에서 "🏠 재택근무" 선택 시 재택근무 페이지로 전환
- [ ] §5.6.2: 직원 선택 시 hr_master.db에서 직원 정보 자동 로드
- [ ] §5.6.3: 일정 관리, 근무 기록 추적, 월간 리포트 생성 기능 정상 작동
- [ ] §5.6.4: 근무 로그가 work_logs 테이블에 저장되고 통합 대시보드에서 조회 가능

### Epic 4: 급여관리 모듈 통합 및 전면 개선

#### Story §5.7: 급여관리 모듈 페이지 전환
**As a** 급여 담당자  
**I want** 통합 대시보드 내에서 급여관리 기능을 사용할 수 있다  
**So that** 급여 계산과 명세서 생성을 한 곳에서 처리할 수 있다

**Acceptance Criteria:**
- [ ] §5.7.1: 사이드바에서 "💰 급여관리" 선택 시 급여관리 페이지로 전환
- [ ] §5.7.2: 직원 선택 시 hr_master.db에서 직원 및 급여 정보 자동 로드
- [ ] §5.7.3: 급여 설정, 월별 급여 계산, 급여대장, 명세서 출력, 시간외 수당, 연차 관리 기능 접근 가능

#### Story §5.8: 급여 계산 → 명세서 자동 반영 (Critical)
**As a** 급여 담당자  
**I want** 계산된 급여 항목이 명세서에 자동으로 반영된다  
**So that** 수동 재입력 없이 정확한 명세서를 생성할 수 있다

**Acceptance Criteria:**
- [ ] §5.8.1: 4대보험 계산 (국민연금, 건강보험, 고용보험, 산재보험) → 명세서 "공제 항목" 자동 반영
- [ ] §5.8.2: 소득세/지방소득세 계산 → 명세서 "공제 항목" 자동 반영
- [ ] §5.8.3: 시간외 수당 계산 (연장/야간/휴일) → 명세서 "지급 항목" 자동 반영
- [ ] §5.8.4: 연차수당 계산 → 명세서 "지급 항목" 자동 반영
- [ ] §5.8.5: 기본급 + 수당 - 공제 = 실수령액 자동 계산 → 명세서 "실수령액" 자동 반영
- [ ] §5.8.6: 계산 후 명세서 미리보기 버튼 클릭 시 모든 항목 정확히 표시
- [ ] §5.8.7: PDF 다운로드 시 모든 계산 결과 포함된 명세서 생성

#### Story §5.9: 급여관리 계산 로직 검증
**As a** 급여 담당자  
**I want** 급여 계산 로직이 2026년 법령 기준으로 정확하다  
**So that** 법적 문제 없이 급여를 지급할 수 있다

**Acceptance Criteria:**
- [ ] §5.9.1: 2026년 국민연금 요율 (4.5%) 적용 확인
- [ ] §5.9.2: 2026년 건강보험 요율 (3.545%) + 장기요양보험 (12.81%) 적용 확인
- [ ] §5.9.3: 2026년 고용보험 요율 (0.9%) 적용 확인
- [ ] §5.9.4: 2026년 소득세율 구간 적용 확인
- [ ] §5.9.5: 2026년 최저임금 (시급 10,030원) 검증 기능 작동 확인
- [ ] §5.9.6: 실제 급여 데이터 3건 이상으로 계산 결과 정확도 검증

#### Story §5.10: 급여관리 UI/UX 개선
**As a** 급여 담당자  
**I want** 급여관리 화면이 직관적이고 사용하기 쉽다  
**So that** 실수 없이 빠르게 급여 업무를 처리할 수 있다

**Acceptance Criteria:**
- [ ] §5.10.1: 급여 계산 플로우 시각화 (데이터 입력 → 계산 → 확인 → 명세서 생성)
- [ ] §5.10.2: 각 단계별 명확한 안내 문구 표시
- [ ] §5.10.3: 계산 중 로딩 인디케이터 표시
- [ ] §5.10.4: 계산 완료 후 성공 메시지 및 결과 요약 표시
- [ ] §5.10.5: 오류 발생 시 명확한 오류 메시지와 해결 방법 제공
- [ ] §5.10.6: 급여대장 테이블에서 각 항목별 정렬 및 필터링 기능 제공

### Epic 5: 데이터 동기화 및 검증

#### Story §5.11: 실시간 데이터 동기화
**As a** 인사 담당자  
**I want** 직원 정보를 수정하면 모든 모듈에 즉시 반영된다  
**So that** 일관된 데이터로 업무를 처리할 수 있다

**Acceptance Criteria:**
- [ ] §5.11.1: 직원 관리 페이지에서 직원 정보 수정 시 hr_master.db 즉시 업데이트
- [ ] §5.11.2: 출산육아 페이지에서 직원 선택 시 최신 정보 표시
- [ ] §5.11.3: 재택근무 페이지에서 직원 선택 시 최신 정보 표시
- [ ] §5.11.4: 급여관리 페이지에서 직원 선택 시 최신 정보 표시
- [ ] §5.11.5: 페이지 새로고침 없이 session_state 업데이트로 즉시 반영

#### Story §5.12: 단계별 통합 검증 (Phase 1: 출산육아)
**As a** 시스템 관리자  
**I want** 출산육아 모듈 통합 후 실제 데이터로 검증할 수 있다  
**So that** 문제 없이 다음 단계로 진행할 수 있다

**Acceptance Criteria:**
- [ ] §5.12.1: 출산육아 모듈 통합 완료 후 기존 직원 데이터로 테스트
- [ ] §5.12.2: 재택근무 로그 생성 기능 정상 작동 확인
- [ ] §5.12.3: 지원금 계산 정확도 확인 (예상 금액 vs 실제 계산 결과)
- [ ] §5.12.4: 정부 서식 PDF 생성 정상 작동 확인
- [ ] §5.12.5: 문제 발생 시 롤백 절차 확인

#### Story §5.13: 단계별 통합 검증 (Phase 2: 재택근무)
**As a** 시스템 관리자  
**I want** 재택근무 모듈 통합 후 실제 데이터로 검증할 수 있다  
**So that** 문제 없이 다음 단계로 진행할 수 있다

**Acceptance Criteria:**
- [ ] §5.13.1: 재택근무 모듈 통합 완료 후 기존 직원 데이터로 테스트
- [ ] §5.13.2: 일정 관리 기능 정상 작동 확인
- [ ] §5.13.3: 근무 기록 추적 정상 작동 확인
- [ ] §5.13.4: 월간 리포트 생성 정상 작동 확인
- [ ] §5.13.5: 문제 발생 시 롤백 절차 확인

#### Story §5.14: 단계별 통합 검증 (Phase 3: 급여관리 - Critical)
**As a** 급여 담당자  
**I want** 급여관리 모듈 통합 후 실제 급여 데이터로 철저히 검증할 수 있다  
**So that** 실수 없이 정확한 급여를 지급할 수 있다

**Acceptance Criteria:**
- [ ] §5.14.1: 급여관리 모듈 통합 완료 후 실제 지급한 급여 명세서 준비 (최소 3건)
- [ ] §5.14.2: 동일한 직원 정보 입력 후 계산 결과 비교 (기존 vs 신규)
- [ ] §5.14.3: 4대보험 계산 결과 100% 일치 확인
- [ ] §5.14.4: 소득세/지방소득세 계산 결과 100% 일치 확인
- [ ] §5.14.5: 시간외 수당 계산 결과 100% 일치 확인
- [ ] §5.14.6: 연차수당 계산 결과 100% 일치 확인
- [ ] §5.14.7: 실수령액 100% 일치 확인
- [ ] §5.14.8: 명세서 PDF에 모든 항목 정확히 표시 확인
- [ ] §5.14.9: 급여대장 엑셀 다운로드 정확도 확인
- [ ] §5.14.10: 불일치 발견 시 원인 분석 및 수정 후 재검증

## §6. User Experience Contract
*→ Extracted into Blueprint §1.5/1.6 User Journey diagrams*

### §6.1 User Visibility Specification

| ID | User Action | User Sees (Exact) | User Does NOT See | Timing |
|----|-------------|-------------------|-------------------|--------|
| V-1 | 로그인 성공 | "환영합니다, [사용자명]님!" 토스트 알림 + 대시보드 화면 전환 | 데이터베이스 쿼리, 세션 생성 과정 | Immediate (< 1초) |
| V-2 | 사이드바 메뉴 선택 | 선택한 메뉴 하이라이트 + 해당 페이지 즉시 로드 | session_state 업데이트, 페이지 리렌더링 과정 | Immediate (< 1초) |
| V-3 | 직원 정보 저장 | "✅ 저장 완료!" 토스트 알림 + 직원 목록에 새 직원 추가 | SQL INSERT 쿼리, 데이터베이스 커밋 | Immediate (< 1초) |
| V-4 | 직원 정보 수정 | "✅ 수정 완료!" 토스트 알림 + 수정된 정보 즉시 반영 | SQL UPDATE 쿼리, 다른 모듈의 캐시 무효화 | Immediate (< 1초) |
| V-5 | 직원 선택 (다른 모듈) | 선택한 직원의 모든 정보 자동 로드 + "직원 정보 불러오기 완료" | 데이터베이스 조회, session_state 동기화 | Immediate (< 1초) |
| V-6 | 급여 계산 시작 | "계산 중..." 로딩 스피너 + 진행률 표시 | 4대보험 계산, 소득세 계산 등 개별 로직 실행 | 1-3초 (계산 복잡도에 따라) |
| V-7 | 급여 계산 완료 | "✅ 계산 완료!" 토스트 + 결과 요약 표시 (지급액, 공제액, 실수령액) | 데이터베이스 저장, 명세서 데이터 준비 | Immediate (계산 완료 직후) |
| V-8 | 급여명세서 미리보기 | 명세서 전체 내용 화면에 표시 (모든 항목 포함) | 명세서 데이터 포맷팅, PDF 렌더링 준비 | Immediate (< 1초) |
| V-9 | 급여명세서 PDF 다운로드 | "PDF 생성 중..." → "✅ 다운로드 완료!" + 파일 다운로드 | PDF 라이브러리 실행, 파일 생성 과정 | 2-5초 (데이터 양에 따라) |
| V-10 | 데이터 마이그레이션 실행 | "마이그레이션 진행 중... [진행률 바]" + 완료 시 "✅ [N]건 마이그레이션 완료!" | JSON 파싱, DB INSERT, 로그 기록 | 5-10초 (데이터 건수에 따라) |
| V-11 | 오류 발생 | "❌ 오류: [구체적 오류 메시지]" + 해결 방법 안내 | 스택 트레이스, 내부 오류 코드 | Immediate (오류 발생 즉시) |
| V-12 | 페이지 전환 중 | 이전 페이지 내용 유지 + 부드러운 전환 애니메이션 | 페이지 언마운트/마운트, session_state 재설정 | Immediate (< 1초) |

### §6.2 Timing & Feedback Expectations

| ID | Event | Expected Timing | User Feedback | Failure Feedback |
|----|-------|-----------------|---------------|------------------|
| T-1 | 로그인 시도 | < 1초 | "환영합니다, [사용자명]님!" | "❌ 로그인 실패: 사용자명 또는 비밀번호가 올바르지 않습니다." |
| T-2 | 페이지 전환 | < 1초 | 선택한 페이지 즉시 로드 | "❌ 페이지 로드 실패. 다시 시도해주세요." |
| T-3 | 직원 정보 저장 | < 1초 | "✅ 저장 완료!" | "❌ 저장 실패: [오류 원인]. 다시 시도해주세요." |
| T-4 | 직원 정보 조회 | < 1초 | 직원 정보 표시 | "❌ 직원을 찾을 수 없습니다." |
| T-5 | 급여 계산 | 1-3초 | "계산 중..." → "✅ 계산 완료!" | "❌ 계산 실패: [오류 원인]. 입력 정보를 확인해주세요." |
| T-6 | 명세서 미리보기 | < 1초 | 명세서 화면 표시 | "❌ 명세서 생성 실패: 계산 데이터를 확인해주세요." |
| T-7 | PDF 다운로드 | 2-5초 | "PDF 생성 중..." → "✅ 다운로드 완료!" | "❌ PDF 생성 실패: [오류 원인]" |
| T-8 | 데이터 마이그레이션 | 5-10초 | "마이그레이션 진행 중... [N/M건]" → "✅ 완료!" | "❌ 마이그레이션 실패: [N]건 실패. 로그를 확인해주세요." |
| T-9 | 엑셀 다운로드 | 1-3초 | "엑셀 생성 중..." → "✅ 다운로드 완료!" | "❌ 엑셀 생성 실패: [오류 원인]" |
| T-10 | 근무 로그 저장 | < 1초 | "✅ 근무 로그 저장 완료!" | "❌ 저장 실패: [오류 원인]" |

## §7. Artifact Ownership
*→ Extracted into Blueprint §2 System Boundaries*

### §7.1 Creation Responsibility

| ID | Artifact | Created By | When | App's Role |
|----|----------|------------|------|------------|
| O-1 | hr_master.db (SQLite 파일) | App | 최초 실행 시 (shared/database.py의 init_master_database()) | Create + Manage |
| O-2 | 직원 레코드 (employees 테이블) | App | 직원 관리 페이지에서 "저장" 버튼 클릭 | Create + Update + Delete |
| O-3 | 근무 로그 (work_logs 테이블) | App | 재택근무 페이지에서 근무 기록 저장 | Create |
| O-4 | 급여 내역 (payroll_history 테이블) | App | 급여관리 페이지에서 급여 계산 후 저장 | Create |
| O-5 | 급여명세서 PDF | App | 급여관리 페이지에서 "PDF 다운로드" 버튼 클릭 | Create + Deliver to User |
| O-6 | 급여대장 Excel | App | 급여관리 페이지에서 "엑셀 다운로드" 버튼 클릭 | Create + Deliver to User |
| O-7 | 출산육아 정부 서식 PDF | App | 출산육아 페이지에서 "PDF 생성" 버튼 클릭 | Create + Deliver to User |
| O-8 | 출산육아 Word 문서 | App | 출산육아 페이지에서 "Word 생성" 버튼 클릭 | Create + Deliver to User |
| O-9 | 시스템 로그 (system_logs 테이블) | App | 모든 주요 액션 발생 시 (로그인, 데이터 변경 등) | Create |
| O-10 | 사용자 세션 (st.session_state) | App | 로그인 성공 시 | Create + Maintain + Destroy (로그아웃 시) |
| O-11 | 마이그레이션 로그 | App | 데이터 마이그레이션 실행 시 | Create + Log to system_logs |

### §7.2 External System Dependencies

| ID | External System | What It Creates | How App Knows | Failure Handling |
|----|-----------------|-----------------|---------------|------------------|
| E-1 | 없음 | N/A | N/A | N/A |

**Note:** 이 시스템은 완전히 독립적으로 실행되며 외부 시스템 의존성이 없습니다. 모든 데이터와 파일은 앱 내부에서 생성됩니다.

### §7.3 Derived Ownership Rules
*These become Blueprint §2.3 Boundary Rules*

| Source | Rule | Rationale |
|--------|------|-----------|
| O-1 | App은 hr_master.db를 직접 생성하고 관리해야 함 | 외부 DB 서버 없이 SQLite로 독립 실행 |
| O-2 | 직원 데이터는 오직 hr_master.db에만 저장하며 JSON 파일 사용 금지 | 데이터 일관성 보장 및 중복 제거 |
| O-5, O-6, O-7, O-8 | 다운로드 파일은 메모리 내에서 생성 후 즉시 전달하며 서버에 저장하지 않음 | 디스크 공간 절약 및 보안 |
| O-9 | 모든 중요 액션은 system_logs에 기록되어야 함 | 감사 추적 및 문제 해결 |
| O-10 | 로그아웃 시 session_state를 완전히 초기화해야 함 | 보안 및 메모리 누수 방지 |

## §8. State Requirements
*→ Extracted into Blueprint §3 State Transition Specifications*

### §8.1 State Isolation

| ID | Requirement | Rationale | Enforcement |
|----|-------------|-----------|-------------|
| SI-1 | 각 사용자의 session_state는 완전히 격리되어야 함 | 다른 사용자의 데이터 노출 방지 | Streamlit 기본 세션 관리 활용 |
| SI-2 | 로그인하지 않은 사용자는 어떤 페이지도 접근할 수 없어야 함 | 무단 접근 방지 | 모든 페이지에서 session_state.logged_in 확인 |
| SI-3 | 페이지 전환 시 이전 페이지의 일시적 상태는 초기화되어야 함 (단, 공통 상태는 유지) | 혼란 방지 및 메모리 효율 | 페이지별 init 함수에서 페이지 특정 상태만 초기화 |
| SI-4 | 급여 계산 중간 데이터는 최종 저장 전까지 임시 session_state에만 유지 | 불완전한 데이터 DB 저장 방지 | 명시적 "저장" 액션 전까지 DB 커밋 금지 |

### §8.2 State Lifecycle

| ID | State | Initial | Created When | Cleared When | Persists Across |
|----|-------|---------|--------------|--------------|------------------|
| SL-1 | session_state.logged_in | False | 로그인 성공 시 True로 설정 | 로그아웃 시 또는 세션 종료 시 | 페이지 전환 (로그인 유지) |
| SL-2 | session_state.user | None | 로그인 성공 시 사용자 정보 저장 | 로그아웃 시 | 페이지 전환 (로그인 유지) |
| SL-3 | session_state.current_employee | None | 직원 선택 시 해당 직원 정보 저장 | 다른 직원 선택 시 또는 로그아웃 시 | 페이지 전환 (선택 유지) |
| SL-4 | session_state.employee_manager | None | 앱 시작 시 EmployeeDataManager 인스턴스 생성 | 세션 종료 시 | 페이지 전환 |
| SL-5 | session_state.payroll_calculator | None | 앱 시작 시 PayrollCalculator 인스턴스 생성 | 세션 종료 시 | 페이지 전환 |
| SL-6 | session_state.current_year_month | 현재 년월 | 앱 시작 시 | 사용자가 변경하거나 세션 종료 시 | 페이지 전환 |
| SL-7 | session_state.payroll_temp_data | {} | 급여 계산 시작 시 | 급여 저장 완료 또는 페이지 이탈 시 | 급여관리 페이지 내에서만 |
| SL-8 | session_state.show_employee_form | False | "새 직원 추가" 또는 "수정" 버튼 클릭 시 True | 저장/취소 버튼 클릭 시 | 직원 관리 페이지 내에서만 |
| SL-9 | session_state.current_page | "대시보드" | 앱 시작 시 | 페이지 전환 시 새 페이지명으로 업데이트 | 페이지 전환 |

## §9. Technical Considerations
*→ Informs Blueprint §5, §6, §9, §11*

### §9.1 Architecture Decisions

**1. Streamlit Multipage App 패턴 채택**
- **결정**: Streamlit의 st.Page + st.navigation API를 사용하여 단일 앱에서 다중 페이지 제공
- **근거**: 
  - 별도 포트 없이 단일 포트(8000)에서 모든 모듈 실행
  - 페이지 간 session_state 공유로 데이터 일관성 보장
  - 사이드바 네비게이션 자연스럽게 통합
- **구현**: 
  - `0_통합_대시보드/app.py`를 메인 앱으로 유지
  - 각 모듈을 `pages/` 폴더의 별도 파일로 분리
  - st.navigation()으로 동적 페이지 라우팅

**2. 중앙 데이터베이스 완전 통합**
- **결정**: 모든 모듈이 hr_master.db를 단일 데이터 소스로 사용
- **근거**:
  - JSON 파일 기반 데이터는 동기화 불가능
  - shared/database.py의 통합 API로 일관된 데이터 접근
  - 외래키 제약조건으로 데이터 무결성 보장
- **구현**:
  - 기존 employees_data.json을 hr_master.db로 마이그레이션
  - 모든 모듈에서 shared.database 모듈 import
  - get_db() 컨텍스트 매니저로 안전한 연결 관리

**3. 급여관리 계산 → 명세서 파이프라인 재설계**
- **결정**: 계산 로직과 명세서 생성 로직을 명확히 분리하고 자동 연결
- **근거**:
  - 현재 계산 결과가 명세서에 반영 안 되는 치명적 문제
  - 수동 재입력은 오류 가능성 높음
  - 데이터 흐름 추적 가능하도록 명확한 인터페이스 필요
- **구현**:
  - PayrollCalculator 클래스의 계산 메서드가 표준화된 딕셔너리 반환
  - format_payslip() 함수가 계산 결과 딕셔너리를 받아 명세서 데이터 생성
  - PDF 생성 함수가 명세서 데이터를 받아 최종 문서 생성
  - 각 단계에서 데이터 검증 로직 추가

**4. 단계별 통합 전략**
- **결정**: 출산육아 → 재택근무 → 급여관리 순서로 순차 통합
- **근거**:
  - 출산육아와 재택근무는 기능 완성도 높아 빠른 통합 가능
  - 급여관리는 전면 개선 필요하여 가장 많은 시간 투입
  - 각 단계에서 검증 후 다음 단계 진행으로 리스크 최소화
- **구현**:
  - 각 단계마다 별도 브랜치 생성 (feature/integrate-maternity 등)
  - 단계별 테스트 스크립트 작성
  - 실제 데이터 기반 검증 후 main 브랜치 병합

### §9.2 Integration Points

**1. shared/database.py 통합 API**
- 모든 모듈이 import하여 사용하는 핵심 모듈
- 제공 기능:
  - `get_db()`: SQLite 연결 컨텍스트 매니저
  - `get_all_employees()`: 전체 직원 조회
  - `get_employee_by_id()`, `get_employee_by_name()`: 특정 직원 조회
  - `add_employee()`, `update_employee()`, `delete_employee()`: 직원 CRUD
  - `get_company_profile()`, `update_company_profile()`: 회사 정보 관리
  - `add_system_log()`: 시스템 로그 기록
- 수정 필요 사항: 없음 (이미 완벽하게 구현됨)

**2. shared/auth.py 인증 시스템**
- 로그인 및 권한 관리 제공
- 제공 기능:
  - `authenticate_user()`: 사용자 인증
  - `check_permission()`: 역할 기반 권한 확인
  - `init_default_users()`: 기본 사용자 생성 (admin, test)
- 통합 방법:
  - 메인 앱에서 로그인 페이지 구현
  - 모든 페이지에서 session_state.logged_in 확인
  - 필요 시 check_permission()으로 권한 체크

**3. shared/design.py 디자인 시스템**
- Modern Green Minimal 디자인 일관성 유지
- 제공 기능:
  - `apply_design()`: 통일된 CSS 적용
  - COLORS, TYPOGRAPHY, SPACING, STYLES 상수
- 통합 방법:
  - 메인 앱과 모든 페이지에서 apply_design() 호출
  - 커스텀 스타일 필요 시 COLORS 등 상수 활용

**4. shared/utils.py 유틸리티**
- 공통 기능 제공
- 제공 기능:
  - `show_success()`, `show_info()`, `show_warning()`, `show_error()`: 토스트 알림
  - `format_currency()`: 금액 포맷팅
  - `format_date()`: 날짜 포맷팅
  - `get_korean_weekday()`: 한글 요일
- 통합 방법:
  - 모든 모듈에서 import하여 일관된 UX 제공

**5. 각 모듈의 app.py 리팩토링**
- 현재: 독립 실행 가능한 Streamlit 앱 (st.set_page_config, main() 함수)
- 변경 후: 페이지 함수로 리팩토링 (예: `def show_maternity_page()`)
- 리팩토링 가이드:
  - st.set_page_config() 제거 (메인 앱에서만 호출)
  - main() 함수를 `show_[module]_page()` 함수로 변경
  - 모듈별 비즈니스 로직은 그대로 유지
  - session_state 초기화 로직 검토 (중복 제거)

**6. 급여관리 모듈 특별 리팩토링**
- 현재 문제: 계산 결과가 명세서에 반영 안 됨
- 해결 방안:
  - calculator.py의 PayrollCalculator 클래스 메서드 반환값 표준화
  - 계산 메서드가 반환하는 딕셔너리 구조 정의:
    ```python
    {
      'basic_salary': int,  # 기본급
      'allowances': {  # 수당
        'overtime': int,
        'night': int,
        'holiday': int,
        'annual_leave': int
      },
      'deductions': {  # 공제
        'national_pension': int,
        'health_insurance': int,
        'long_term_care': int,
        'employment_insurance': int,
        'income_tax': int,
        'local_tax': int
      },
      'total_payment': int,  # 총 지급액
      'total_deduction': int,  # 총 공제액
      'net_payment': int  # 실수령액
    }
    ```
  - format_payslip() 함수가 이 구조를 받아 명세서 생성
  - PDF 생성 시 명세서 데이터 그대로 사용

### §9.3 Constraints

**1. 기술 제약**
- Python 3.8 이상 필수
- Streamlit 1.32.0 이상 (st.Page + st.navigation API 지원)
- SQLite 3.x (WAL 모드 지원 필요)
- 서버 메모리 최소 2GB (여러 사용자 동시 접속 시)

**2. 데이터 제약**
- 기존 데이터 완전 보존 필수 (마이그레이션 시 무손실)
- 외래키 제약조건 유지 (employees → work_logs, applications 등)
- 문자열 인코딩 UTF-8 (한글 지원)

**3. 보안 제약**
- 비밀번호 해싱 필수 (SHA256 + salt)
- 로그인하지 않은 사용자는 모든 페이지 접근 차단
- 급여 정보는 관리자/HR 역할만 접근 가능

**4. 성능 제약**
- 페이지 전환 1초 이내
- 직원 목록 조회 1초 이내 (최대 1000명 가정)
- 급여 계산 3초 이내
- PDF 생성 5초 이내

**5. 호환성 제약**
- 기존 모듈의 비즈니스 로직 최대한 보존
- 사용자가 익숙한 UI 패턴 유지 (급격한 변경 지양)
- 기존 엑셀/PDF 다운로드 파일 형식 유지

## §10. Success Metrics
*→ Informs Blueprint §10 Testing Strategy*

| ID | Metric | Target | Measurement Method |
|----|--------|--------|--------------------|
| M-1 | 포트 통합 완료 | 단일 포트(8000)에서 모든 모듈 실행 | 포트 8501-8505 접속 불가, 포트 8000에서 모든 기능 접근 가능 |
| M-2 | 데이터 입력 중복 제거율 | 100% | 직원 정보 한 번 입력 시 모든 모듈에서 자동 로드 확인 |
| M-3 | 급여명세서 자동 반영 정확도 | 100% | 실제 급여 데이터 3건 이상으로 계산 결과와 명세서 일치 확인 |
| M-4 | 데이터 마이그레이션 무손실 | 100% | 마이그레이션 전후 데이터 건수 및 내용 일치 확인 |
| M-5 | 페이지 전환 속도 | < 1초 | 사이드바 메뉴 클릭 후 페이지 로드 시간 측정 |
| M-6 | 직원 정보 동기화 지연 시간 | < 1초 | 직원 관리 페이지에서 수정 후 다른 페이지에서 반영 시간 측정 |
| M-7 | 급여 계산 정확도 | 100% | 2026년 법령 기준 4대보험, 소득세 계산 결과 검증 |
| M-8 | 사용자 만족도 | "매우 편리함" | 인사 담당자 피드백 ("포트 여러 개 열 필요 없어서 편함", "데이터 입력 한 번만 해도 돼서 좋음") |
| M-9 | 코드 품질 | Linter 오류 0개 | Pylint/Flake8 실행 결과 |
| M-10 | 단위 테스트 커버리지 | 급여 계산 로직 90% 이상 | pytest + coverage 실행 결과 |
| M-11 | 통합 테스트 성공률 | 100% | 각 단계별 통합 테스트 모두 통과 |
| M-12 | 롤백 가능성 | 각 단계별 롤백 성공 | 문제 발생 시 이전 단계로 복구 가능 확인 |

---

## Appendix A: Answer Traceability

| User Answer (Summary) | Captured In |
|-----------------------|-------------|
| Q1: 1단계 통합 (출산육아 + 재택근무 + 급여), 2단계는 나중에 | §1, §4.1 (FR-5, FR-6, FR-7, FR-17), §5 (Epic 구조) |
| Q1: 급여관리는 추가 개선 작업 병행 필요 | §2, §4.1 (FR-7), §5 (Epic 4) |
| Q2: 통합 직원 관리 페이지 방식 선택 | §1, §4.1 (FR-3, FR-4), §5 (Story §5.2) |
| Q2: 각 모듈에서는 선택만 하면 자동으로 정보 불러오기 | §4.1 (FR-4), §5.2, §6.1 (V-5), §8.2 (SL-3) |
| Q3: 사이드바 메뉴 방식 선택 | §1, §4.1 (FR-2), §5 (Story §5.1), §6.1 (V-2) |
| Q4: 1, 2, 3, 4, 5 전부 개선 필요 | §2, §5 (Epic 4), §9.1 (Architecture Decision 3) |
| Q4: 계산된 값이 명세서에 자동으로 반영되지 않음 | §2, §4.1 (FR-8~FR-12), §5 (Story §5.8), §9.1 (Architecture Decision 3), §10 (M-3) |
| Q5: A + C 혼합 방식 (단계별 + 실제 데이터 검증) | §4.2 (NFR-9), §5 (Story §5.12~§5.14), §9.1 (Architecture Decision 4), §10 (M-3, M-11) |
| Q5: 1단계 출산육아, 2단계 재택근무, 3단계 급여관리 (가장 신중) | §5 (Story §5.12~§5.14), §9.1 (Architecture Decision 4) |
| 원본: 포트 분리 불편함 | §1, §2, §4.1 (FR-1), §10 (M-1) |
| 원본: 데이터 입력 중복 | §1, §2, §4.1 (FR-3, FR-4), §10 (M-2) |
| 원본: hr_master.db 통합 DB 활용 | §1, §4.1 (FR-13, FR-14), §9.1 (Architecture Decision 2) |
| 코드베이스: 통합 DB 이미 구축됨 | §1 (Overview), §9.2 (Integration Point 1) |
| 코드베이스: 일부 모듈 JSON 파일 사용 | §2, §4.1 (FR-14), §5 (Story §5.5) |
| 코드베이스: shared 모듈 완비 | §9.2 (Integration Points 1~4) |

**Validation:** ✅ All user answers have been captured. No information lost.

---

*문서 생성 일시: 2026-01-28*  
*프로젝트: 인사팀 자동화 시스템 통합*  
*버전: 1.0*
