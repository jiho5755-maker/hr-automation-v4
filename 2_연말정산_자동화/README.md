# 💰 연말정산 자동화 - PDF 파서

**국세청 간소화 PDF 자동 추출 시스템 (웹 UI)**

---

## ✨ 주요 기능

### 📄 자동 추출 항목

- **의료비**: 의료비 지출액 + 실손의료보험금 (자동 차감)
- **보험료**: 건강보험료, 고용보험료, 국민연금보험료
- **신용카드**: 사용액 합계
- **주택**: 전세자금 대출 원리금 상환액
- **주택청약**: 주택청약저축 납입액
- **기부금**: 종교/일반 기부금
- **교육비**: 대학/취학전/초중고 교육비

### 🎨 웹 UI

- **간편한 업로드**: 드래그 앤 드롭으로 PDF 업로드
- **실시간 파싱**: 자동으로 데이터 추출
- **보기 좋은 결과**: 금액별 요약 + 상세 내역
- **엑셀 다운로드**: 회계 처리용 엑셀 생성

---

## 🚀 빠른 시작

### 1단계: 실행

#### 방법 1: 더블클릭 (가장 쉬움!)
`🚀_실행하기.command` 파일을 더블클릭

브라우저가 자동으로 `http://localhost:8502` 열림!

#### 방법 2: 터미널
```bash
cd ~/Desktop/인사팀_자동화_통합/2_연말정산_자동화
python3 -m streamlit run app.py --server.port 8502
```

### 2단계: 사용

1. **PDF 업로드**: '📤 PDF 업로드' 탭에서 파일 선택
2. **파싱 시작**: '🚀 PDF 파싱 시작' 버튼 클릭
3. **결과 확인**: '📊 파싱 결과' 탭에서 내역 확인
4. **다운로드**: '📥 엑셀 다운로드' 탭에서 엑셀 저장

---

## 📊 화면 구성

### 탭 1: PDF 업로드
- 드래그 앤 드롭으로 PDF 업로드
- 파일명 및 크기 확인
- 파싱 시작 버튼

### 탭 2: 파싱 결과
- **금액 요약**: 4개 메트릭 카드
  - 의료비 (순)
  - 보험료
  - 카드 사용
  - 주택 관련
- **상세 내역**: 펼치기/접기 가능
  - 의료비 상세
  - 보험료 상세
  - 주택 관련 상세
  - 기부금/교육비 (있는 경우)

### 탭 3: 엑셀 다운로드
- 생성 정보 (파일명, 시트 수, 시각)
- 다운로드 버튼
- 포함 내용 안내

---

## 📁 파일 구조

```
2_연말정산_자동화/
├── 🚀_실행하기.command  ← 더블클릭!
├── app.py                # Streamlit 웹 UI (NEW!)
├── pdf_parser.py         # 메인 파서 엔진
├── housing_parser.py     # 주택 관련 파서
├── excel_mapper.py       # 엑셀 매핑
├── requirements.txt      # 패키지 의존성
└── README.md            # 이 파일
```

---

## 💡 사용 시나리오

### 시나리오 1: 개인 연말정산

```
1. 국세청 홈택스에서 PDF 다운로드
2. 🚀_실행하기.command 더블클릭
3. PDF 업로드
4. 결과 확인
5. 엑셀 다운로드
6. 회사 제출
```

**소요 시간**: 2분

---

### 시나리오 2: 회사 전체 연말정산 (50명)

```
1. 전 직원 PDF 수집
2. 웹 UI 실행
3. 한 명씩 업로드 → 파싱 → 엑셀 다운로드
4. 50개 엑셀 파일 취합
5. 회계 처리
```

**소요 시간**: 직원당 1분 × 50명 = 50분

---

## 🎨 UI 디자인

**테마**: Blue Professional (전문적인 파란색 계열)
- **메인**: 밝은 파란색 그라데이션
- **사이드바**: 진한 파란색
- **카드**: 흰색 배경 + 파란색 강조
- **버튼**: 파란색 그라데이션 + 호버 효과

---

## 📊 출력 예시

### 웹 UI 화면
```
💰 연말정산 자동화 - PDF 파서

[탭: PDF 업로드 | 파싱 결과 | 엑셀 다운로드]

┌─────────────────────────────────────┐
│ 💊 의료비 (순)     🛡️ 보험료        │
│ 1,200,000원        2,400,000원      │
│ 실손보험: 300,000원  3건            │
│                                      │
│ 💳 카드 사용       🏠 주택 관련     │
│ 15,000,000원       6,200,000원      │
└─────────────────────────────────────┘
```

### 엑셀 파일 (5개 시트)
1. **요약**: 전체 항목별 금액
2. **의료비**: 의료기관별 내역
3. **보험료**: 보험 종류별 납입액
4. **기부금**: 기부처별 내역
5. **교육비**: 교육기관별 내역

---

## 🆚 터미널 vs 웹 UI

| 항목 | 터미널 (구버전) | 웹 UI (신버전) |
|------|----------------|---------------|
| **실행** | 명령어 입력 | 더블클릭 |
| **파일 선택** | 경로 입력 | 드래그 앤 드롭 |
| **결과 확인** | 텍스트 출력 | 보기 좋은 카드 |
| **다운로드** | 없음 | 엑셀 다운로드 |
| **난이도** | 중급 | 초급 |

---

## ⚙️ 터미널 CLI도 사용 가능

웹 UI가 아닌 터미널에서도 사용 가능합니다:

```bash
python3 pdf_parser.py [PDF파일경로]
```

예시:
```bash
python3 pdf_parser.py ~/Desktop/연말정산2025.pdf
```

출력:
```
====================================================
📄 PDF 파싱 완료!
====================================================

💰 의료비: 1,500,000원
   - 실손보험금: 300,000원
   - 실제 공제 가능: 1,200,000원
🛡️ 보험료: 2,400,000원 (3건)
💳 신용카드: 15,000,000원
🏠 전세자금: 5,000,000원
🏦 주택청약: 1,200,000원
```

---

## 💡 핵심 알고리즘

### 의료비 파싱
- "의료비 인별합계금액" 라인에서 총 지출액 추출
- "[실손의료보험금]" 섹션에서 수령액 추출
- 순 의료비 = 총 지출액 - 실손보험금

### 보험료 파싱
- 건강보험료: "총합계" 라인에서 추출
- 고용보험료: "합계" 라인에서 추출
- 국민연금: "합계" 라인에서 추출

### 주택 관련 파싱
- 전세자금: "주택임차차입금" 섹션의 "합계" 라인
- 주택청약: "주택마련저축" 섹션의 "합계" 라인

---

## ⚠️ 주의사항

1. **PDF 형식**: 국세청 간소화 서비스 PDF 형식에 최적화되어 있습니다.
2. **정확도**: 항상 결과를 수동으로 확인하세요.
3. **개인정보**: PDF에는 민감한 정보가 포함되어 있으니 주의하세요.
4. **버전**: 국세청 양식이 변경되면 파서 업데이트가 필요할 수 있습니다.
5. **로컬 처리**: 모든 데이터는 로컬에서만 처리되며 외부로 전송되지 않습니다.

---

## 🔧 문제 해결

### Q. 브라우저가 자동으로 열리지 않아요
```
수동으로 접속: http://localhost:8502
```

### Q. 포트 충돌 (Address already in use)
```bash
# 다른 포트로 실행
streamlit run app.py --server.port 8505
```

### Q. PDF 업로드가 안돼요
- 파일 크기 확인 (최대 200MB)
- 파일 확장자 확인 (.pdf)
- 브라우저 새로고침

### Q. 파싱 결과가 0원으로 나옴
- PDF가 국세청 간소화 서비스 형식인지 확인
- 터미널 CLI로 시도해보기
- debug_medical.py로 특정 페이지 확인

---

## 📞 기술 지원

- **Python 버전**: 3.8 이상
- **Streamlit**: https://streamlit.io
- **pdfplumber**: https://github.com/jsvine/pdfplumber
- **실행 포트**: 8502

---

## 🎯 업데이트 내역

### v1.0 (2026-01-27)
- ✨ **웹 UI 추가**: Streamlit 기반
- ✨ PDF 드래그 앤 드롭
- ✨ 실시간 파싱
- ✨ 엑셀 다운로드
- ✅ 기존 터미널 CLI 유지

---

**💰 연말정산 자동화 - PDF 파서**  
*이제 웹 브라우저에서 클릭 몇 번으로 끝!*
