version: '3.8'

services:
  # 통합 대시보드
  dashboard:
    build:
      context: ./0_통합_대시보드
      dockerfile: Dockerfile
    container_name: hr-dashboard
    ports:
      - "8000:8000"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # 출산육아 자동화
  maternity:
    build:
      context: ./1_출산육아_자동화
      dockerfile: Dockerfile
    container_name: hr-maternity
    ports:
      - "8501:8501"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./1_출산육아_자동화/employees_data.json:/app/employees_data.json
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # 연말정산 자동화
  yearend:
    build:
      context: ./2_연말정산_자동화
      dockerfile: Dockerfile
    container_name: hr-yearend
    ports:
      - "8502:8502"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # 재택근무 관리시스템
  remote:
    build:
      context: ./3_재택근무_관리시스템
      dockerfile: Dockerfile
    container_name: hr-remote
    ports:
      - "8503:8503"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # 정부지원금 자동화
  subsidy:
    build:
      context: ./4_정부지원금_자동화
      dockerfile: Dockerfile
    container_name: hr-subsidy
    ports:
      - "8504:8504"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # 급여관리 자동화
  payroll:
    build:
      context: ./5_급여관리_자동화
      dockerfile: Dockerfile
    container_name: hr-payroll
    ports:
      - "8505:8505"
    volumes:
      - ./hr_master.db:/app/hr_master.db
      - ./shared:/app/shared:ro
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    networks:
      - hr_network

  # Nginx 리버스 프록시 (선택사항)
  nginx:
    image: nginx:alpine
    container_name: hr-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/html:/usr/share/nginx/html:ro
    depends_on:
      - dashboard
      - maternity
      - yearend
      - remote
      - subsidy
      - payroll
    restart: unless-stopped
    networks:
      - hr_network

networks:
  hr_network:
    driver: bridge

volumes:
  hr_data:
    driver: local
